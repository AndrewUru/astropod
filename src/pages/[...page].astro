---
import BaseLayout from "../layouts/BaseLayout.astro";
import HorizontalCard from "../components/HorizontalCard.astro";
import { getCollection } from "astro:content";
import astropodConfig from "../../.astropod/astropod.config.json";
import HeaderCard from "../components/headerCard/HeaderCard.astro";
import AudioPlayer from "../components/audioPlayer.astro";
import PlainTextRenderer from "marked-plaintext";
import { marked } from "marked";
import Pagination from "../components/pagination.astro";

const renderer = new PlainTextRenderer();

export async function getStaticPaths({ paginate }) {
  const episodes = await getCollection("episode");
  episodes.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
  return paginate(episodes, { pageSize: astropodConfig.pageSize });
}
const { page } = Astro.props;
---

<BaseLayout>
  <HeaderCard title={astropodConfig.name} subtitle={astropodConfig.author} />

  <div class="card min-w-full bg-base-100 shadow-md p-3 pb-3 mt-12">
    {
      page.data.map((episode, index) => (
        <HorizontalCard
          title={episode.data.title}
          cover={episode.data.cover}
          desc={marked.parse(episode.body.slice(0, 500), { renderer: renderer })}
          url={"/episode/" + episode.slug}
          audioUrl={episode.data.audioUrl}
          pubDate={episode.data.pubDate}
          duration={episode.data.duration}
          id={"card-" + index}
        />
      ))
    }
  </div>
  {(page.url.next || page.url.prev) && <Pagination page={page} />}
   <!-- Sección Explicativa sobre Astropod -->
  <section class="mt-8 p-4 bg-base-100 shadow-md rounded-md">
    <h2 class="text-2xl font-bold mb-4">¿Qué es Astropod?</h2>
    <p class="mb-2">
      Astropod es una solución gratuita y de código abierto para la creación y alojamiento de podcasts de manera autosuficiente. Es un proyecto diseñado para ofrecer una plataforma sin servidores, lo que significa que puedes gestionar tu propio podcast sin depender de servicios de terceros.
    </p>
    <p class="mb-2">
      Con Astropod, puedes subir episodios, organizar tus contenidos, y compartir tu podcast con el mundo de forma sencilla y eficiente. Todo esto con la flexibilidad que te proporciona ser el propietario de tus propios datos y sin comisiones por el servicio.
    </p>
    <p class="mb-2">
      Este servicio ha sido construido utilizando Astro, un moderno framework estático, lo que permite un rendimiento optimizado y una experiencia de usuario rápida y fluida.
    </p>
    <p class="mb-2">
      Si quieres saber más, visita el <a href="https://getastropod.netlify.app/" target="_blank" class="underline text-blue-500">sitio oficial de Astropod</a>.
    </p>
  </section>
</BaseLayout>

<AudioPlayer />
